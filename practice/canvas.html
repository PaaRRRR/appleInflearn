<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Canvas Animate</title>
    <link rel="stylesheet" href="./css/default.css" />
  </head>
  <style>
    .container {
      width: 100%;
      height: 200vh;
      background: wheat;
      position: relative;
    }

    #myCanvas,
    #myCanvas2 {
      width: 100%;
      height: 100vh;
    }

    .checkBall {
      width: 50px;
      height: 50px;
      border-radius: 100%;
      background: mediumaquamarine;
      position: absolute;
      top: 25%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
  <body>
    <div class="container">
      <canvas id="myCanvas" width="1440" height="1080">
        Your browser does not support the canvas element.
      </canvas>
      <canvas id="myCanvas2" width="1440" height="1080">
        Your browser does not support the canvas element.
      </canvas>
      <canvas id="myCanvas3" width="1440" height="1080">
        Your browser does not support the canvas element.
      </canvas>
      <div class="checkBall"></div>
    </div>

    <script>
      var canvas,
        ctx,
        canvas2,
        ctx2,
        canvas3,
        ctx3,
        centerOfCanvas,
        imgElem2,
        canvasImg,
        canvasWidth,
        canvasHeight,
        imgWidth,
        imgHeight,
        calcImgWidth,
        calcImgHeight,
        widthHeightRatio,
        // widthRatio,
        // heightRatio,
        // selectedRatio,
        // calcWidth,
        // calcHeight,
        // posWidth,
        moveRafId,
        count,
        // angle,
        givenImageWHRatio,
        givenImgCanvasRatio;

      function DegToRad(d) {
        // Converts degrees to radians
        return d * 0.01745;
      }

      function init() {
        canvas = document.getElementById("myCanvas");
        ctx = canvas.getContext("2d");

        canvas2 = document.getElementById("myCanvas2");
        ctx2 = canvas2.getContext("2d");

        canvas3 = document.getElementById("myCanvas3");
        ctx3 = canvas3.getContext("2d");

        centerOfCanvas = [0, 0];
        imgElem2 = new Image();
        // imgElem2.src = "./assets/images/pod_mask2.svg";
        imgElem2.src = "./assets/images/LightBox.jpg";

        canvasImg = imgElem2;

        imgWidth = imgElem2.width;
        imgHeight = imgElem2.height;

        widthHeightRatio = imgWidth / imgHeight;

        count = 0;
        angle = 0;

        givenImageWHRatio = 1;
        givenImgCanvasRatio = 0.4;
      }

      function setLayout() {
        canvasWidth = window.document.documentElement.clientWidth;
        canvasHeight = window.innerHeight;

        canvas.width = canvasWidth;
        canvas.height = canvasHeight;

        canvas2.width = canvasWidth;
        canvas2.height = canvasHeight;

        canvas3.width = canvasWidth;
        canvas3.height = canvasHeight;
      }

      function checkDeviceWH() {}

      function setCanvasImg() {
        // also check img is bigger than and smaller than canvas..
        // always be centered
        calcImgWidth = canvasWidth * givenImgCanvasRatio;
        calcImgHeight = canvasHeight * givenImgCanvasRatio;
        var calcImgWidthFromHeight = calcImgHeight * givenImageWHRatio;

        if (calcImgWidthFromHeight < calcImgWidth) {
          calcImgWidth = calcImgWidthFromHeight;
        } else {
          calcImgHeight = calcImgWidth / givenImageWHRatio;
        }

        imgElem2.width = calcImgWidth;
        imgElem2.height = calcImgHeight;

        // widthRatio = calcImgWidth / canvasWidth;
        // heightRatio = calcImgHeight / canvasHeight;

        // selectedRatio = widthRatio;

        // if (widthRatio < heightRatio) {
        //   selectedRatio = widthRatio;
        // } else {
        //   selectedRatio = heightRatio;
        // }

        // calcWidth = Math.floor(calcImgWidth / selectedRatio);
        // calcHeight = Math.floor(calcImgHeight / selectedRatio);

        // posWidth = (canvasWidth - calcWidth) / 2;
        // ctx2.drawImage(canvasImg, posWidth, 0);
      }

      function moveAnimation() {
        ctx2.save();

        ctx2.clearRect(0, 0, canvasWidth, canvasHeight);

        // ctx2.translate(canvasWidth * 0.5, canvasHeight * 0.5);
        // ctx2.rotate(DegToRad(180 * count));
        // ctx2.drawImage(
        //   canvasImg,
        //   -calcImgWidth * 0.5,
        //   -calcImgHeight * 0.5,
        //   calcImgWidth,
        //   calcImgHeight
        // );

        const recalculatedImgWidth = calcImgWidth * count;
        const recalculatedImgHeight = calcImgHeight * count;

        ctx2.translate(canvasWidth * 0.5, canvasHeight * 0.5);
        ctx2.rotate(DegToRad(180 * count));
        ctx2.drawImage(
          canvasImg,
          -recalculatedImgWidth * 0.5,
          -recalculatedImgHeight * 0.5,
          recalculatedImgWidth,
          recalculatedImgHeight
        );

        ctx2.restore();

        /*
         *
         * ctx3
         *
         */

        drawing(recalculatedImgHeight);

        // ctx3.save();
        // ctx3.clearRect(0, 0, canvasWidth, canvasHeight);
        // ctx3.fillRect(0, 0, canvasWidth, canvasHeight / 2 - radius);
        // ctx3.fillRect(
        //   0,
        //   canvasHeight / 2 + radius,
        //   canvasWidth,
        //   canvasHeight / 2 - radius
        // );
        // ctx3.beginPath();
        // // left
        // ctx3.moveTo(0, canvasHeight / 2 - radius);
        // ctx3.lineTo(canvasWidth / 2, canvasHeight / 2 - radius);
        // ctx3.arc(
        //   canvasWidth * 0.5,
        //   canvasHeight * 0.5,
        //   radius,
        //   -Math.PI / 2,
        //   Math.PI / 2,
        //   true
        // );
        // ctx3.lineTo(0, canvasHeight / 2 + radius);
        // ctx3.lineTo(0, canvasHeight / 2 - radius);
        // // right
        // ctx3.moveTo(canvasWidth, canvasHeight / 2 - radius);
        // ctx3.lineTo(canvasWidth / 2, canvasHeight / 2 - radius);
        // ctx3.arc(
        //   canvasWidth * 0.5,
        //   canvasHeight * 0.5,
        //   radius,
        //   -Math.PI / 2,
        //   Math.PI / 2,
        //   false
        // );
        // ctx3.lineTo(canvasWidth, canvasHeight / 2 + radius);
        // ctx3.lineTo(canvasWidth, canvasHeight / 2 - radius);
        // ctx3.fill();
        // ctx3.restore();

        // count += 1 / 180;
        // angle++;
        // moveRafId = requestAnimationFrame(moveAnimation);

        if (count < 2) {
          count += 0.001;
          moveRafId = requestAnimationFrame(moveAnimation);
        } else {
          cancelAnimationFrame(moveRafId);
        }
      }

      function drawing(radius) {
        ctx3.save();
        ctx3.clearRect(0, 0, canvasWidth, canvasHeight);
        // ctx3.fillRect(0, 0, canvasWidth, canvasHeight / 2 - radius);
        // ctx3.fillRect(
        //   0,
        //   canvasHeight / 2 + radius,
        //   canvasWidth,
        //   canvasHeight / 2 - radius
        // );
        ctx3.beginPath();
        // left
        ctx3.moveTo(0, 0);
        ctx3.lineTo(canvasWidth / 2, 0);
        ctx3.lineTo(canvasWidth / 2, canvasHeight / 2 - radius);
        ctx3.arc(
          canvasWidth * 0.5,
          canvasHeight * 0.5,
          radius,
          -Math.PI / 2,
          Math.PI / 2,
          true
        );
        ctx3.lineTo(canvasWidth / 2, canvasHeight);
        ctx3.lineTo(0, canvasHeight);
        ctx3.lineTo(0, 0);
        // right
        ctx3.moveTo(canvasWidth, 0);
        ctx3.lineTo(canvasWidth / 2, 0);
        ctx3.lineTo(canvasWidth / 2, canvasHeight / 2 - radius);
        ctx3.arc(
          canvasWidth * 0.5,
          canvasHeight * 0.5,
          radius,
          -Math.PI / 2,
          Math.PI / 2,
          false
        );
        ctx3.lineTo(canvasWidth / 2, canvasHeight);
        ctx3.lineTo(canvasWidth, canvasHeight);
        ctx3.lineTo(canvasWidth, 0);
        ctx3.fill();
        ctx3.restore();
      }

      window.addEventListener("load", function() {
        init();
        setLayout();

        centerOfCanvas[0] = Math.floor(canvasWidth / 2);
        centerOfCanvas[1] = Math.floor(canvasHeight / 2);

        ctx.fillStyle = "#FF0000";
        ctx.fillRect(centerOfCanvas[0], centerOfCanvas[1], 150, 75);

        ctx3.fillStyle = "#888888";
        // ctx3.strokeStyle = "#FF0000";

        // drawing();
        // ctx3.fillRect(centerOfCanvas[0], centerOfCanvas[1], 150, 75);

        setCanvasImg();
        moveAnimation();
      });
    </script>
  </body>
</html>
